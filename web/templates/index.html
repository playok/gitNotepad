<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Git Notepad</title>
    <script>window.BASE_PATH = '{{.basePath}}';</script>
    <link rel="stylesheet" href="{{.basePath}}/static/lib/fonts/fonts.css">
    <link rel="stylesheet" href="{{.basePath}}/static/lib/highlight/github-dark.min.css">
    <link rel="stylesheet" href="{{.basePath}}/static/lib/katex/katex.min.css">
    <link rel="stylesheet" href="{{.basePath}}/static/css/style.css">
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h1>Git Notepad</h1>
                <div class="sidebar-header-actions">
                    <button id="newNoteBtn" class="header-icon-btn" title="New Note (Ctrl+N)" data-i18n-title="sidebar.newNote">
                        <span>&#10133;</span>
                    </button>
                    <button id="helpBtn" class="header-icon-btn" title="Help (F1)" data-i18n-title="sidebar.help">
                        <span>?</span>
                    </button>
                    <button id="settingsBtn" class="header-icon-btn" title="Settings" data-i18n-title="sidebar.settings">
                        <span>&#9881;</span>
                    </button>
                    <div class="locale-selector" id="localeSelector">
                        <button class="header-icon-btn" id="localeSelectorBtn" title="Language" data-i18n-title="sidebar.language">
                            <span class="locale-flag">EN</span>
                        </button>
                        <div class="locale-dropdown" id="localeDropdown">
                            <button class="locale-option" data-locale="en">
                                <span class="locale-code">EN</span>
                                <span class="locale-name">English</span>
                            </button>
                            <button class="locale-option" data-locale="ko">
                                <span class="locale-code">KO</span>
                                <span class="locale-name">ÌïúÍµ≠Ïñ¥</span>
                            </button>
                        </div>
                    </div>
                    <button id="themeToggle" class="header-icon-btn" title="Toggle theme" data-i18n-title="sidebar.toggleTheme">
                        <span class="icon-sun">&#9728;</span>
                        <span class="icon-moon">&#9790;</span>
                    </button>
                    {{if .user}}
                    <div class="user-menu" id="userMenu">
                        <button class="header-icon-btn" id="userMenuBtn" title="{{.user.Username}}">
                            <span>&#128100;</span>
                        </button>
                        <div class="user-dropdown" id="userDropdown">
                            <div class="user-dropdown-header">
                                <span class="user-icon-large">&#128100;</span>
                                <div class="user-info">
                                    <span class="user-name-large">{{.user.Username}}</span>
                                    {{if .user.IsAdmin}}<span class="user-role">Admin</span>{{end}}
                                </div>
                            </div>
                            <div class="user-dropdown-divider"></div>
                            {{if .user.IsAdmin}}
                            <a href="#" class="user-dropdown-item" id="adminUsersBtn">
                                <span>&#128101;</span> Manage Users
                            </a>
                            {{end}}
                            <a href="#" class="user-dropdown-item" id="logoutBtn">
                                <span>&#128682;</span> Logout
                            </a>
                        </div>
                    </div>
                    {{end}}
                    <button id="sidebarCollapseBtn" class="header-icon-btn" title="Toggle sidebar (Ctrl+B)" data-i18n-title="sidebar.collapseShortcut">
                        <span class="collapse-icon">&#9664;</span>
                    </button>
                </div>
            </div>
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Search notes..." data-i18n-placeholder="sidebar.search">
                <button id="searchClear" class="search-clear" title="Clear search" data-i18n-title="sidebar.clearSearch">√ó</button>
            </div>
            <div class="folder-actions">
                <button id="expandAllBtn" class="folder-action-btn" title="Expand All" data-i18n-title="sidebar.expandAll">
                    <span class="folder-action-icon">üìÇ</span>
                    <span class="folder-action-text" data-i18n="sidebar.expandAll">Expand All</span>
                </button>
                <button id="collapseAllBtn" class="folder-action-btn" title="Collapse All" data-i18n-title="sidebar.collapseAll">
                    <span class="folder-action-icon">üìÅ</span>
                    <span class="folder-action-text" data-i18n="sidebar.collapseAll">Collapse All</span>
                </button>
            </div>
            <ul id="noteList" class="note-list">
                <!-- Notes will be loaded here -->
            </ul>
            <!-- Mini Calendar (Bottom Fixed) -->
            <div class="mini-calendar" id="miniCalendar">
                <div class="mini-calendar-header">
                    <button id="miniCalToggle" class="mini-cal-toggle" title="Toggle calendar" data-i18n-title="calendar.toggle">&#9660;</button>
                    <button id="miniCalPrev" class="mini-cal-nav">&#9664;</button>
                    <span id="miniCalTitle" class="mini-cal-title"></span>
                    <button id="miniCalNext" class="mini-cal-nav">&#9654;</button>
                </div>
                <div class="mini-calendar-body" id="miniCalBody">
                    <div class="mini-calendar-weekdays">
                        <span class="mini-weekday sunday">S</span>
                        <span class="mini-weekday">M</span>
                        <span class="mini-weekday">T</span>
                        <span class="mini-weekday">W</span>
                        <span class="mini-weekday">T</span>
                        <span class="mini-weekday">F</span>
                        <span class="mini-weekday saturday">S</span>
                    </div>
                    <div id="miniCalGrid" class="mini-calendar-grid">
                        <!-- Mini calendar days will be rendered here -->
                    </div>
                </div>
            </div>
        </aside>

        <!-- Sidebar Splitter -->
        <div class="sidebar-splitter" id="sidebarSplitter">
            <div class="splitter-handle"></div>
        </div>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Date Notes Panel -->
            <div id="dateNotesPanel" class="date-notes-panel" style="display: none;">
                <div class="date-notes-header">
                    <div class="date-notes-title">
                        <span class="date-notes-icon">&#128197;</span>
                        <span id="dateNotesPanelTitle"></span>
                    </div>
                    <button id="dateNotesPanelClose" class="date-notes-close" title="Close" data-i18n-title="common.close">&times;</button>
                </div>
                <div id="dateNotesList" class="date-notes-list">
                    <!-- Date notes will be rendered here -->
                </div>
                <div class="date-notes-footer">
                    <button id="dateNotesNewBtn" class="date-notes-new-btn">
                        <span>&#10133;</span>
                        <span data-i18n="datePanel.newNote">New note for this date</span>
                    </button>
                </div>
            </div>

            <!-- Empty State -->
            <div id="emptyState" class="empty-state">
                <h2 data-i18n="app.selectNote">Select a note or create a new one</h2>
                <p data-i18n="app.subtitle">Your notes are automatically saved and version controlled with Git.</p>
            </div>

            <!-- Editor -->
            <div id="editor" class="editor" style="display: none;">
                <div class="editor-header">
                    <div class="editor-title-row">
                        <span id="noteFolderPath" class="note-folder-path"></span>
                        <input type="text" id="noteTitle" class="note-title-input" placeholder="Note title...">
                        <span id="saveStatus" class="save-status"></span>
                    </div>
                    <div class="editor-actions">
                        <select id="noteType" class="note-type-select" title="Note type" data-i18n-title="editor.noteType">
                            <option value="markdown">MD</option>
                            <option value="asciidoc">ADOC</option>
                            <option value="txt">TXT</option>
                        </select>
                        <button id="prettyJsonBtn" class="btn-icon" title="Format JSON (Ctrl+Shift+F)" data-i18n-title="editor.formatJsonShortcut">{&nbsp;}</button>
                        <button id="syntaxHelpBtn" class="btn-icon" title="Syntax Reference" data-i18n-title="editor.syntaxHelp">&#128214;</button>
                        <button id="uploadBtn" class="btn-icon" title="Upload file" data-i18n-title="editor.upload">&#128206;</button>
                        <input type="file" id="fileInput" style="display: none;" multiple>
                        <label class="private-toggle" title="Private note" data-i18n-title="editor.privateNote">
                            <input type="checkbox" id="notePrivate">
                            <span class="private-icon">&#128274;</span>
                        </label>
                        <label class="autosave-toggle" title="Auto-save" data-i18n-title="editor.autoSave">
                            <input type="checkbox" id="autoSaveEnabled">
                            <span class="autosave-icon">&#128260;</span>
                        </label>
                        <button id="historyBtn" class="btn-icon" title="History" data-i18n-title="editor.history">&#128337;</button>
                        <button id="saveBtn" class="btn-icon" title="Save" data-i18n-title="editor.save">&#128190;</button>
                        <button id="deleteBtn" class="btn-icon btn-icon-danger" title="Delete" data-i18n-title="editor.delete">&#128465;</button>
                    </div>
                </div>
                <!-- Attachments Section -->
                <div id="attachmentsSection" class="attachments-section" style="display: none;">
                    <div class="attachments-header">
                        <span class="attachments-icon">&#128206;</span>
                        <span class="attachments-title" data-i18n="editor.attachments">Attachments</span>
                        <span id="attachmentsCount" class="attachments-count">0</span>
                        <button id="attachmentsToggle" class="attachments-toggle" title="Toggle attachments" data-i18n-title="editor.toggleAttachments">
                            <span class="toggle-icon">&#9660;</span>
                        </button>
                    </div>
                    <div id="attachmentsList" class="attachments-list">
                        <!-- Attachments will be rendered here -->
                    </div>
                </div>
                <!-- Markdown Toolbar -->
                <div id="markdownToolbar" class="markdown-toolbar">
                    <div class="toolbar-group">
                        <button type="button" class="toolbar-btn" data-action="bold" data-i18n-title="toolbar.bold"><b>B</b></button>
                        <button type="button" class="toolbar-btn" data-action="italic" data-i18n-title="toolbar.italic"><i>I</i></button>
                        <button type="button" class="toolbar-btn" data-action="strikethrough" data-i18n-title="toolbar.strikethrough"><s>S</s></button>
                        <button type="button" class="toolbar-btn" data-action="code" data-i18n-title="toolbar.code">&lt;&gt;</button>
                    </div>
                    <div class="toolbar-separator"></div>
                    <div class="toolbar-group">
                        <button type="button" class="toolbar-btn" data-action="h1" data-i18n-title="toolbar.h1">H1</button>
                        <button type="button" class="toolbar-btn" data-action="h2" data-i18n-title="toolbar.h2">H2</button>
                        <button type="button" class="toolbar-btn" data-action="h3" data-i18n-title="toolbar.h3">H3</button>
                    </div>
                    <div class="toolbar-separator"></div>
                    <div class="toolbar-group">
                        <button type="button" class="toolbar-btn" data-action="link" data-i18n-title="toolbar.link">&#128279;</button>
                        <button type="button" class="toolbar-btn" data-action="image" data-i18n-title="toolbar.image">&#128444;</button>
                    </div>
                    <div class="toolbar-separator"></div>
                    <div class="toolbar-group">
                        <button type="button" class="toolbar-btn" data-action="quote" data-i18n-title="toolbar.quote">&#10077;</button>
                        <button type="button" class="toolbar-btn" data-action="ul" data-i18n-title="toolbar.ul">&#8226;</button>
                        <button type="button" class="toolbar-btn" data-action="ol" data-i18n-title="toolbar.ol">1.</button>
                        <button type="button" class="toolbar-btn" data-action="tasklist" data-i18n-title="toolbar.tasklist">&#9745;</button>
                    </div>
                    <div class="toolbar-separator"></div>
                    <div class="toolbar-group">
                        <div class="toolbar-btn-wrapper">
                            <button type="button" class="toolbar-btn" data-action="codeblock" data-i18n-title="toolbar.codeblock" id="codeblockToolbarBtn">&#9641;&#9641;&#9641;</button>
                            <div class="code-lang-selector" id="codeLangSelector">
                                <div class="lang-grid-container" id="codeLangContainer"></div>
                            </div>
                        </div>
                        <div class="toolbar-btn-wrapper">
                            <button type="button" class="toolbar-btn" data-action="table" data-i18n-title="toolbar.table" id="tableToolbarBtn">&#9638;</button>
                            <div class="table-grid-selector" id="tableGridSelector">
                                <div class="grid-container" id="tableGridContainer"></div>
                                <div class="grid-label" id="tableGridLabel"></div>
                            </div>
                        </div>
                        <button type="button" class="toolbar-btn" data-action="hr" data-i18n-title="toolbar.hr">‚Äï</button>
                    </div>
                </div>
                <div class="editor-body">
                    <div class="editor-pane">
                        <div id="codemirrorEditor" class="codemirror-wrapper"></div>
                        <textarea id="noteContent" style="display:none;"></textarea>
                    </div>
                    <div class="splitter" id="editorSplitter">
                        <div class="splitter-handle"></div>
                    </div>
                    <div id="previewPane" class="preview-pane">
                        <div id="previewContent"></div>
                    </div>
                </div>
            </div>

            <!-- Password Modal -->
            <div id="passwordModal" class="modal" style="display: none;">
                <div class="modal-content">
                    <h3>Private Note</h3>
                    <p>Enter password to access this note:</p>
                    <input type="password" id="passwordInput" placeholder="Password">
                    <div class="modal-actions">
                        <button id="passwordCancel" class="btn btn-secondary">Cancel</button>
                        <button id="passwordSubmit" class="btn btn-primary">Unlock</button>
                    </div>
                </div>
            </div>

            <!-- Set Password Modal -->
            <div id="setPasswordModal" class="modal" style="display: none;">
                <div class="modal-content">
                    <h3>Set Password</h3>
                    <p>Enter a password for this private note:</p>
                    <input type="password" id="setPasswordInput" placeholder="Password">
                    <input type="password" id="confirmPasswordInput" placeholder="Confirm password">
                    <div class="modal-actions">
                        <button id="setPasswordCancel" class="btn btn-secondary">Cancel</button>
                        <button id="setPasswordSubmit" class="btn btn-primary">Set Password</button>
                    </div>
                </div>
            </div>

            <!-- History Modal -->
            <div id="historyModal" class="modal" style="display: none;">
                <div class="modal-content modal-large">
                    <h3>Version History</h3>
                    <div id="historyList" class="history-list">
                        <!-- History items will be loaded here -->
                    </div>
                    <div class="modal-actions">
                        <button id="historyClose" class="btn btn-secondary">Close</button>
                    </div>
                </div>
            </div>

            <!-- Version View Modal -->
            <div id="versionModal" class="modal" style="display: none;">
                <div class="modal-content modal-large">
                    <h3>Version: <span id="versionHash"></span></h3>
                    <div id="versionContent" class="version-content"></div>
                    <div class="modal-actions">
                        <button id="versionRestore" class="btn btn-primary">Restore this version</button>
                        <button id="versionClose" class="btn btn-secondary">Close</button>
                    </div>
                </div>
            </div>

            <!-- Syntax Help Modal -->
            <div id="syntaxHelpModal" class="modal" style="display: none;">
                <div class="modal-content modal-large syntax-help-modal">
                    <div class="settings-header">
                        <h3 data-i18n="syntax.title">Syntax Reference</h3>
                        <button id="syntaxHelpClose" class="modal-close-btn">&times;</button>
                    </div>
                    <div class="syntax-help-body">
                        <div class="syntax-tabs">
                            <button class="syntax-tab active" data-syntax="markdown">Markdown</button>
                            <button class="syntax-tab" data-syntax="asciidoc">AsciiDoc</button>
                        </div>
                        <div class="syntax-content">
                            <!-- Markdown Syntax -->
                            <div class="syntax-panel active" id="syntaxMarkdown">
                                <div class="syntax-section">
                                    <h4 data-i18n="syntax.headers">Headers</h4>
                                    <div class="syntax-example">
                                        <pre><code># H1
## H2
### H3</code></pre>
                                        <div class="syntax-result">
                                            <div style="font-size:1.5em;font-weight:bold;border-bottom:1px solid var(--border)">H1</div>
                                            <div style="font-size:1.25em;font-weight:bold;border-bottom:1px solid var(--border)">H2</div>
                                            <div style="font-size:1.1em;font-weight:bold">H3</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="syntax-section">
                                    <h4 data-i18n="syntax.emphasis">Emphasis</h4>
                                    <div class="syntax-example">
                                        <pre><code>**bold**
*italic*
~~strike~~
`code`</code></pre>
                                        <div class="syntax-result">
                                            <div><strong>bold</strong></div>
                                            <div><em>italic</em></div>
                                            <div><del>strike</del></div>
                                            <div><code>code</code></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="syntax-section">
                                    <h4 data-i18n="syntax.lists">Lists</h4>
                                    <div class="syntax-example">
                                        <pre><code>- Item 1
- Item 2
  - Nested

1. First
2. Second</code></pre>
                                        <div class="syntax-result">
                                            <ul style="margin:0;padding-left:1.2em"><li>Item 1</li><li>Item 2<ul><li>Nested</li></ul></li></ul>
                                            <ol style="margin:0;padding-left:1.2em"><li>First</li><li>Second</li></ol>
                                        </div>
                                    </div>
                                </div>
                                <div class="syntax-section">
                                    <h4 data-i18n="syntax.links">Links & Images</h4>
                                    <div class="syntax-example">
                                        <pre><code>[Link](url)
![Alt](img.jpg)</code></pre>
                                        <div class="syntax-result">
                                            <div><a href="#" style="color:var(--accent)">Link</a></div>
                                            <div><span style="border:1px dashed var(--border);padding:2px 8px;font-size:0.75em">üñº Alt</span></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="syntax-section">
                                    <h4 data-i18n="syntax.codeBlocks">Code Blocks</h4>
                                    <div class="syntax-example">
                                        <pre><code>```js
const x = 1;
```</code></pre>
                                        <div class="syntax-result">
                                            <pre style="margin:0;padding:4px 8px;background:var(--bg-tertiary);border-radius:4px;font-size:0.75em"><code>const x = 1;</code></pre>
                                        </div>
                                    </div>
                                </div>
                                <div class="syntax-section">
                                    <h4 data-i18n="syntax.blockquotes">Blockquotes</h4>
                                    <div class="syntax-example">
                                        <pre><code>> Quote
>> Nested</code></pre>
                                        <div class="syntax-result">
                                            <blockquote style="margin:0;padding-left:8px;border-left:3px solid var(--accent);color:var(--text-secondary)">Quote<blockquote style="margin:4px 0 0;padding-left:8px;border-left:3px solid var(--border)">Nested</blockquote></blockquote>
                                        </div>
                                    </div>
                                </div>
                                <div class="syntax-section">
                                    <h4 data-i18n="syntax.tables">Tables</h4>
                                    <div class="syntax-example">
                                        <pre><code>| H1 | H2 |
|----|-----|
| A  | B   |</code></pre>
                                        <div class="syntax-result">
                                            <table style="border-collapse:collapse;font-size:0.75em;width:100%"><tr><th style="border:1px solid var(--border);padding:2px 6px;background:var(--bg-tertiary)">H1</th><th style="border:1px solid var(--border);padding:2px 6px;background:var(--bg-tertiary)">H2</th></tr><tr><td style="border:1px solid var(--border);padding:2px 6px">A</td><td style="border:1px solid var(--border);padding:2px 6px">B</td></tr></table>
                                        </div>
                                    </div>
                                </div>
                                <div class="syntax-section">
                                    <h4 data-i18n="syntax.taskList">Task List</h4>
                                    <div class="syntax-example">
                                        <pre><code>- [ ] Todo
- [x] Done</code></pre>
                                        <div class="syntax-result">
                                            <div><input type="checkbox" disabled> Todo</div>
                                            <div><input type="checkbox" checked disabled> Done</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="syntax-section">
                                    <h4 data-i18n="syntax.horizontalRule">Horizontal Rule</h4>
                                    <div class="syntax-example">
                                        <pre><code>---</code></pre>
                                        <div class="syntax-result">
                                            <hr style="border:none;border-top:1px solid var(--border);margin:8px 0">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- AsciiDoc Syntax -->
                            <div class="syntax-panel" id="syntaxAsciidoc">
                                <div class="syntax-section">
                                    <h4 data-i18n="syntax.headers">Headers</h4>
                                    <div class="syntax-example">
                                        <pre><code>= Title (H1)
== Section (H2)
=== Sub (H3)</code></pre>
                                        <div class="syntax-result">
                                            <div style="font-size:1.5em;font-weight:bold;border-bottom:1px solid var(--border)">Title (H1)</div>
                                            <div style="font-size:1.25em;font-weight:bold;border-bottom:1px solid var(--border)">Section (H2)</div>
                                            <div style="font-size:1.1em;font-weight:bold">Sub (H3)</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="syntax-section">
                                    <h4 data-i18n="syntax.emphasis">Emphasis</h4>
                                    <div class="syntax-example">
                                        <pre><code>*bold*
_italic_
`mono`
#mark#
^sup^
~sub~</code></pre>
                                        <div class="syntax-result">
                                            <div><strong>bold</strong></div>
                                            <div><em>italic</em></div>
                                            <div><code>mono</code></div>
                                            <div><mark>mark</mark></div>
                                            <div>X<sup>sup</sup></div>
                                            <div>H<sub>sub</sub></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="syntax-section">
                                    <h4 data-i18n="syntax.lists">Lists</h4>
                                    <div class="syntax-example">
                                        <pre><code>* Item
** Nested

. First
.. Sub</code></pre>
                                        <div class="syntax-result">
                                            <ul style="margin:0;padding-left:1.2em"><li>Item<ul><li>Nested</li></ul></li></ul>
                                            <ol style="margin:0;padding-left:1.2em"><li>First<ol><li>Sub</li></ol></li></ol>
                                        </div>
                                    </div>
                                </div>
                                <div class="syntax-section">
                                    <h4 data-i18n="syntax.links">Links & Images</h4>
                                    <div class="syntax-example">
                                        <pre><code>https://x.com[Link]
image::a.jpg[Alt]</code></pre>
                                        <div class="syntax-result">
                                            <div><a href="#" style="color:var(--accent)">Link</a></div>
                                            <div><span style="border:1px dashed var(--border);padding:2px 8px;font-size:0.75em">üñº Alt</span></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="syntax-section">
                                    <h4 data-i18n="syntax.codeBlocks">Code Blocks</h4>
                                    <div class="syntax-example">
                                        <pre><code>[source,js]
----
const x=1;
----</code></pre>
                                        <div class="syntax-result">
                                            <pre style="margin:0;padding:4px 8px;background:var(--bg-tertiary);border-radius:4px;font-size:0.75em"><code>const x=1;</code></pre>
                                        </div>
                                    </div>
                                </div>
                                <div class="syntax-section">
                                    <h4 data-i18n="syntax.blockquotes">Blockquotes</h4>
                                    <div class="syntax-example">
                                        <pre><code>[quote,Author]
____
Quote text
____</code></pre>
                                        <div class="syntax-result">
                                            <blockquote style="margin:0;padding-left:8px;border-left:3px solid var(--accent);color:var(--text-secondary)">Quote text<footer style="font-size:0.75em;margin-top:4px">‚Äî Author</footer></blockquote>
                                        </div>
                                    </div>
                                </div>
                                <div class="syntax-section">
                                    <h4 data-i18n="syntax.tables">Tables</h4>
                                    <div class="syntax-example">
                                        <pre><code>|===
|H1 |H2
|A |B
|===</code></pre>
                                        <div class="syntax-result">
                                            <table style="border-collapse:collapse;font-size:0.75em;width:100%"><tr><th style="border:1px solid var(--border);padding:2px 6px;background:var(--bg-tertiary)">H1</th><th style="border:1px solid var(--border);padding:2px 6px;background:var(--bg-tertiary)">H2</th></tr><tr><td style="border:1px solid var(--border);padding:2px 6px">A</td><td style="border:1px solid var(--border);padding:2px 6px">B</td></tr></table>
                                        </div>
                                    </div>
                                </div>
                                <div class="syntax-section">
                                    <h4 data-i18n="syntax.cellSpan">Cell Span</h4>
                                    <div class="syntax-example">
                                        <pre><code>2+|2 cols
.2+|2 rows
2.3+|2x3</code></pre>
                                        <div class="syntax-result">
                                            <table style="border-collapse:collapse;font-size:0.7em;width:100%"><tr><td colspan="2" style="border:1px solid var(--border);padding:2px 4px;background:var(--accent-bg);text-align:center">2 cols</td></tr><tr><td rowspan="2" style="border:1px solid var(--border);padding:2px 4px;background:var(--accent-bg)">2 rows</td><td style="border:1px solid var(--border);padding:2px 4px">B</td></tr><tr><td style="border:1px solid var(--border);padding:2px 4px">C</td></tr></table>
                                        </div>
                                    </div>
                                </div>
                                <div class="syntax-section">
                                    <h4 data-i18n="syntax.admonitions">Admonitions</h4>
                                    <div class="syntax-example">
                                        <pre><code>NOTE: Info
TIP: Hint
WARNING: Warn</code></pre>
                                        <div class="syntax-result">
                                            <div style="padding:4px 8px;background:#e3f2fd;border-left:3px solid #2196f3;margin-bottom:4px;font-size:0.75em;border-radius:2px"><strong>üìò</strong> Info</div>
                                            <div style="padding:4px 8px;background:#e8f5e9;border-left:3px solid #4caf50;margin-bottom:4px;font-size:0.75em;border-radius:2px"><strong>üí°</strong> Hint</div>
                                            <div style="padding:4px 8px;background:#fff3e0;border-left:3px solid #ff9800;font-size:0.75em;border-radius:2px"><strong>‚ö†Ô∏è</strong> Warn</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="syntax-section">
                                    <h4 data-i18n="syntax.horizontalRule">Horizontal Rule</h4>
                                    <div class="syntax-example">
                                        <pre><code>'''</code></pre>
                                        <div class="syntax-result">
                                            <hr style="border:none;border-top:1px solid var(--border);margin:8px 0">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Admin Users Modal -->
            <div id="adminUsersModal" class="modal" style="display: none;">
                <div class="modal-content modal-large">
                    <div class="modal-header">
                        <h3>User Management</h3>
                        <button id="addUserBtn" class="btn btn-primary btn-sm">+ Add User</button>
                    </div>
                    <div id="usersList" class="users-list">
                        <!-- Users will be loaded here -->
                    </div>
                    <div class="modal-actions">
                        <button id="adminUsersClose" class="btn btn-secondary">Close</button>
                    </div>
                </div>
            </div>

            <!-- Add User Modal -->
            <div id="addUserModal" class="modal" style="display: none;">
                <div class="modal-content">
                    <h3>Add New User</h3>
                    <form id="addUserForm">
                        <div class="form-group">
                            <label for="newUsername">Username</label>
                            <input type="text" id="newUsername" placeholder="Username" required minlength="3" maxlength="32">
                        </div>
                        <div class="form-group">
                            <label for="newPassword">Password</label>
                            <input type="password" id="newPassword" placeholder="Password" required minlength="6">
                        </div>
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="newIsAdmin">
                                <span>Administrator</span>
                            </label>
                        </div>
                        <div class="modal-actions">
                            <button type="button" id="addUserCancel" class="btn btn-secondary">Cancel</button>
                            <button type="submit" class="btn btn-primary">Create User</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Settings Modal -->
            <div id="settingsModal" class="modal" style="display: none;">
                <div class="modal-content modal-large settings-modal">
                    <div class="settings-header">
                        <h3 data-i18n="settings.title">Settings</h3>
                        <button id="settingsClose" class="modal-close-btn">&times;</button>
                    </div>
                    <div class="settings-body">
                        <div class="settings-tabs">
                            <button class="settings-tab active" data-tab="general">
                                <span>&#9881;</span> <span data-i18n="settings.general">General</span>
                            </button>
                            {{if .user}}{{if .user.IsAdmin}}
                            <button class="settings-tab" data-tab="users">
                                <span>&#128101;</span> <span data-i18n="settings.users">Users</span>
                            </button>
                            {{end}}{{end}}
                            <button class="settings-tab" data-tab="links">
                                <span>&#128279;</span> <span data-i18n="settings.sharedLinks">Shared Links</span>
                            </button>
                            <button class="settings-tab" data-tab="data">
                                <span>&#128451;</span> <span data-i18n="settings.data">Data</span>
                            </button>
                            <button class="settings-tab" data-tab="stats">
                                <span>&#128202;</span> <span data-i18n="settings.usage">Usage</span>
                            </button>
                        </div>
                        <div class="settings-content">
                            <!-- General Tab -->
                            <div class="settings-panel active" id="settingsGeneral">
                                <h4 data-i18n="settings.generalSettings">General Settings</h4>
                                <div class="settings-section">
                                    <div class="settings-item">
                                        <div class="settings-item-info">
                                            <span class="settings-item-label" data-i18n="settings.theme">Theme</span>
                                            <span class="settings-item-desc" data-i18n="settings.themeDesc">Choose light or dark mode</span>
                                        </div>
                                        <select id="settingsTheme" class="settings-select">
                                            <option value="light" data-i18n="settings.light">Light</option>
                                            <option value="dark" data-i18n="settings.dark">Dark</option>
                                            <option value="dark-high-contrast" data-i18n="settings.darkHighContrast">Dark (High Contrast)</option>
                                            <option value="dark-cyan" data-i18n="settings.darkCyan">Dark (Cyan)</option>
                                        </select>
                                    </div>
                                    <div class="settings-item">
                                        <div class="settings-item-info">
                                            <span class="settings-item-label" data-i18n="settings.defaultType">Default Note Type</span>
                                            <span class="settings-item-desc" data-i18n="settings.defaultTypeDesc">Default format for new notes</span>
                                        </div>
                                        <select id="settingsDefaultType" class="settings-select">
                                            <option value="markdown" data-i18n="type.markdown">Markdown</option>
                                            <option value="asciidoc" data-i18n="type.asciidoc">AsciiDoc</option>
                                            <option value="txt" data-i18n="type.text">Plain Text</option>
                                        </select>
                                    </div>
                                    <div class="settings-item">
                                        <div class="settings-item-info">
                                            <span class="settings-item-label" data-i18n="settings.autoSave">Auto Save</span>
                                            <span class="settings-item-desc" data-i18n="settings.autoSaveDesc">Automatically save changes</span>
                                        </div>
                                        <label class="toggle-switch">
                                            <input type="checkbox" id="settingsAutoSave">
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </div>
                                    <div class="settings-item">
                                        <div class="settings-item-info">
                                            <span class="settings-item-label" data-i18n="settings.lineNumbers">Line Numbers</span>
                                            <span class="settings-item-desc" data-i18n="settings.lineNumbersDesc">Show line numbers in editor</span>
                                        </div>
                                        <label class="toggle-switch">
                                            <input type="checkbox" id="settingsLineNumbers" checked>
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </div>
                                    <div class="settings-item">
                                        <div class="settings-item-info">
                                            <span class="settings-item-label" data-i18n="settings.fontSize">Font Size</span>
                                            <span class="settings-item-desc" data-i18n="settings.fontSizeDesc">Editor and preview font size</span>
                                        </div>
                                        <select id="settingsFontSize" class="settings-select">
                                            <option value="12">12px</option>
                                            <option value="13">13px</option>
                                            <option value="14" selected>14px</option>
                                            <option value="15">15px</option>
                                            <option value="16">16px</option>
                                            <option value="18">18px</option>
                                            <option value="20">20px</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Users Tab (Admin only) -->
                            <div class="settings-panel" id="settingsUsers">
                                <div class="settings-panel-header">
                                    <h4 data-i18n="settings.userManagement">User Management</h4>
                                    <button id="settingsAddUserBtn" class="btn btn-primary btn-sm">+ <span data-i18n="admin.addUser">Add User</span></button>
                                </div>
                                <div id="settingsUsersList" class="users-list">
                                    <!-- Users will be loaded here -->
                                </div>
                            </div>

                            <!-- Shared Links Tab -->
                            <div class="settings-panel" id="settingsLinks">
                                <div class="settings-panel-header">
                                    <h4 data-i18n="settings.sharedLinksManagement">Shared Links Management</h4>
                                    <button id="deleteAllSharedLinksBtn" class="btn btn-danger btn-sm" style="display: none;">
                                        <span data-i18n="settings.deleteAll">Delete All</span>
                                    </button>
                                </div>
                                <div id="sharedLinksEmpty" class="shared-links-empty">
                                    <span class="empty-icon">&#128279;</span>
                                    <span data-i18n="settings.noSharedLinks">No shared links yet</span>
                                </div>
                                <div id="sharedLinksList" class="shared-links-list">
                                    <!-- Shared links will be loaded here -->
                                </div>
                            </div>

                            <!-- Data Tab -->
                            <div class="settings-panel" id="settingsData">
                                <h4 data-i18n="settings.dataManagement">Data Management</h4>
                                <div class="settings-section">
                                    <div class="data-action-card">
                                        <div class="data-action-icon">&#128229;</div>
                                        <div class="data-action-info">
                                            <span class="data-action-title" data-i18n="settings.exportNotes">Export Notes</span>
                                            <span class="data-action-desc" data-i18n="settings.exportNotesDesc">Download all your notes as a ZIP file</span>
                                        </div>
                                        <button id="exportNotesBtn" class="btn btn-primary" data-i18n="stats.export">Export</button>
                                    </div>
                                    <div class="data-action-card">
                                        <div class="data-action-icon">&#128228;</div>
                                        <div class="data-action-info">
                                            <span class="data-action-title" data-i18n="settings.importNotes">Import Notes</span>
                                            <span class="data-action-desc" data-i18n="settings.importNotesDesc">Import notes from a ZIP file</span>
                                        </div>
                                        <div class="import-controls">
                                            <input type="file" id="importFileInput" accept=".zip" style="display: none;">
                                            <button id="importNotesBtn" class="btn btn-secondary" data-i18n="stats.import">Import</button>
                                        </div>
                                    </div>
                                    <div class="data-action-card danger">
                                        <div class="data-action-icon">&#128465;</div>
                                        <div class="data-action-info">
                                            <span class="data-action-title" data-i18n="settings.deleteAllNotes">Delete All Notes</span>
                                            <span class="data-action-desc" data-i18n="settings.deleteAllNotesDesc">Permanently delete all your notes</span>
                                        </div>
                                        <button id="deleteAllNotesBtn" class="btn btn-danger" data-i18n="stats.deleteAll">Delete All</button>
                                    </div>
                                </div>
                            </div>

                            <!-- Stats Tab -->
                            <div class="settings-panel" id="settingsStats">
                                <div class="stats-header">
                                    <h4 data-i18n="settings.usageStatistics">Usage Statistics</h4>
                                    <button id="refreshStatsBtn" class="btn-icon" data-i18n-title="stats.refresh" title="Refresh">&#8635;</button>
                                </div>
                                <div class="stats-grid" id="statsGrid">
                                    <div class="stat-card">
                                        <span class="stat-icon">&#128196;</span>
                                        <span class="stat-value" id="statTotalNotes">-</span>
                                        <span class="stat-label" data-i18n="stats.totalNotes">Total Notes</span>
                                    </div>
                                    <div class="stat-card">
                                        <span class="stat-icon">&#128206;</span>
                                        <span class="stat-value" id="statTotalAttachments">-</span>
                                        <span class="stat-label" data-i18n="stats.totalAttachments">Attachments</span>
                                    </div>
                                    <div class="stat-card">
                                        <span class="stat-icon">&#128274;</span>
                                        <span class="stat-value" id="statPrivateNotes">-</span>
                                        <span class="stat-label" data-i18n="stats.privateNotes">Private Notes</span>
                                    </div>
                                    <div class="stat-card">
                                        <span class="stat-icon">&#128190;</span>
                                        <span class="stat-value" id="statStorageUsed">-</span>
                                        <span class="stat-label" data-i18n="stats.storageUsed">Storage Used</span>
                                    </div>
                                </div>
                                <div class="stats-details">
                                    <h5>Notes by Type</h5>
                                    <div class="stats-bar-chart" id="notesByType">
                                        <!-- Chart will be rendered here -->
                                    </div>
                                    <h5>Recent Activity</h5>
                                    <div class="recent-activity" id="recentActivity">
                                        <!-- Recent activity will be loaded here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AsciiDoc Table Editor Modal -->
            <div id="tableEditorModal" class="table-editor-modal">
                <div class="table-editor-content">
                    <div class="table-editor-header">
                        <h3 data-i18n="tableEditor.title">AsciiDoc Table Editor</h3>
                        <button class="table-editor-close" id="tableEditorClose">&times;</button>
                    </div>
                    <div class="table-editor-instructions" data-i18n="tableEditor.instructions">
                        Click and drag to select cells for merging. Click "Merge" to combine selected cells.
                    </div>
                    <div class="table-editor-info">
                        <span id="tableEditorSize">Size: 0 x 0</span>
                        <span id="tableEditorSelection">Selected: 0 cells</span>
                    </div>
                    <div class="table-editor-preview" id="tableEditorPreview">
                        <table id="tableEditorTable"></table>
                    </div>
                    <div class="table-editor-actions">
                        <button id="tableEditorUnmerge" disabled data-i18n="tableEditor.unmerge">Unmerge</button>
                        <button id="tableEditorMerge" disabled data-i18n="tableEditor.merge">Merge Cells</button>
                        <button id="tableEditorCancel" data-i18n="common.cancel">Cancel</button>
                        <button id="tableEditorInsert" class="primary" data-i18n="tableEditor.insert">Insert Table</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="{{.basePath}}/static/lib/marked.min.js"></script>
    <script src="{{.basePath}}/static/lib/highlight/highlight.min.js"></script>
    <script src="{{.basePath}}/static/lib/katex/katex.min.js"></script>
    <script src="{{.basePath}}/static/lib/katex/auto-render.min.js"></script>
    <script src="{{.basePath}}/static/lib/asciidoctor.min.js"></script>
    <!-- CodeMirror 5 -->
    <link rel="stylesheet" href="{{.basePath}}/static/lib/codemirror/codemirror.min.css">
    <link rel="stylesheet" href="{{.basePath}}/static/lib/codemirror/dracula.min.css">
    <script src="{{.basePath}}/static/lib/codemirror/codemirror.min.js"></script>
    <script src="{{.basePath}}/static/lib/codemirror/overlay.min.js"></script>
    <script src="{{.basePath}}/static/lib/codemirror/xml.min.js"></script>
    <script src="{{.basePath}}/static/lib/codemirror/markdown.min.js"></script>
    <script src="{{.basePath}}/static/lib/codemirror/gfm.min.js"></script>
    <script src="{{.basePath}}/static/lib/codemirror/continuelist.min.js"></script>
    <script>
        // Set up Asciidoctor global (compatible with 3.x)
        (function() {
            // 3.x uses Asciidoctor$$module$build$asciidoctor_browser factory function
            if (typeof Asciidoctor$$module$build$asciidoctor_browser === 'function') {
                var asciidoctorInstance = Asciidoctor$$module$build$asciidoctor_browser();
                window.Asciidoctor = function() { return asciidoctorInstance; };
            }
            // Fallback for 2.x and earlier
            else if (typeof Opal !== 'undefined' && Opal.Asciidoctor) {
                window.Asciidoctor = function() { return Opal.Asciidoctor; };
            }
        })();
    </script>
    <script src="{{.basePath}}/static/js/i18n.js"></script>
    <script src="{{.basePath}}/static/js/app.js"></script>
</body>
</html>
